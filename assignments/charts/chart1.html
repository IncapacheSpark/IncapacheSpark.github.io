<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- Load d3.js -->
  <script src="https://d3js.org/d3.v6.js"></script>

  <link rel="stylesheet" href="../../css/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet"
        type='text/css'>

</head>
<body>

<!-- ################################# NAVBAR #################################### -->
<nav class="navbar navbar-default background-color navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed colored_text" data-toggle="collapse"
              data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../index.html">
        <img alt="Logo" src="../../img/logo.svg" class="img-logo">
      </a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    </div><!-- /.navbar-collapse -->
  </div>
</nav>

<nav class="breadcrumb-pos" aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="../../index.html">Home</a></li>
    <li class="breadcrumb-item"><a href="../comparison.html">Assignment 1</a></li>
    <li class="breadcrumb-item active" aria-current="page">Barchart</li>
  </ol>
</nav>

<div class="container center">
  <h1 class="title margin-title-section"> Top N tree types in Trento</h1>
  <hr>
  <!-- Create a div where the graph will take place -->
  <div id="barchart"></div>
</div>

<script>

  // set the dimensions and margins of the graph
  const margin = {top: 10, right: 20, bottom: 30, left: 180},
          width = 760 - margin.left - margin.right,
          height = 600 - margin.top - margin.bottom;

  // append the svg object to the body of the page
  const svg = d3.select("#barchart")
          .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr("transform", `translate(${margin.left}, ${margin.top})`);

  d3.csv("../../python/data/geo_data_chart1.csv").then(function (data, num = 20) {

    // select only the n first rows from the csv
    var topN = data.slice(0, num).reverse()

    // find the max value for X axis viz
    var max = Math.max.apply(Math, topN.map(function (value) {
      return value.count;
    }));

    // X axis
    const x = d3.scaleLinear()
            .domain([0, max])
            .range([0, height]);

    svg.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x))

    // Add Y axis
    const y = d3.scaleBand()
            .range([0, width])
            .domain(topN.map(d => d.Name))
            .padding(0.2);

    svg.append("g")
            .call(d3.axisLeft(y));

    // create a tooltip
    var tooltip = d3.select("#barchart")
            .append("div")
            .attr("class", "tooltip")
            .style("background-color", "white")
            .style("border", "solid")
            .style("border-width", "1px")
            .style("border-radius", "5px")
            .style("padding", "10px")


    // Bars
    svg.selectAll("mybar")
            .data(topN)
            .join("rect")
            .attr("y", d => y(d.Name))
            .attr("height", y.bandwidth())
            .attr("fill", "#69b3a2")
            // no bar at the beginning thus:
            .attr("width", d => x(0)) // always equal to 0
            .attr("x", d => x(0))
            // Three function that change the tooltip
            .on("mouseover", function (event, d) {
              tooltip.transition()
                      .duration(200)
                      .style("opacity", 1);
              tooltip.html("<span class='tooltiptext'>" + "Aboundance: " + d.count + "<br>" + "Average Canopy size (m2): " + d.Mean_canopy_size + "</span>")
                      .style("left", (event.pageX) + "px")
                      .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", function (d) {
              tooltip.transition()
                      .duration(500)
                      .style("opacity", 0);
            });

    // Animation
    svg.selectAll("rect")
            .transition()
            .duration(500)
            .attr("x", d => x(0))
            .attr("width", d => x(d.count))
            .delay((d, i) => {
              return i * 10
            })

  })

</script>

</body>

<!-- ################################# FOOTER #################################### -->


<footer class="text-center text-lg-start">
  <div class="footer-top-space text-center p-3 background-color colored_text">
    Â© 2022 Copyright:
    <a class="text-dark colored_text" href="https://github.com/IncapacheSpark/IncapacheSpark.github.io">IncApacheSpark
      Github</a>
  </div>
</footer>
</html>