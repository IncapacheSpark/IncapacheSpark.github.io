<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans&family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet"> <!-- Fira Sans & Roboto Slab fonts -->
    <link rel="stylesheet" href="../../css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"  rel="stylesheet"  type='text/css'>

    <title>IncapacheSpark</title>
  </head>

  <body>
<!-- python -m http.server -->
  <!-- ################################# NAVBAR #################################### -->
  <nav class="navbar navbar-default background-color navbar-fixed-top">
      <div class="container">
          <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed colored_text" data-toggle="collapse"
                      data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="#">
                  <img alt="Logo" src="../../img/logo.svg" class="img-logo">
              </a>
          </div>
          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav navbar-right">
                  <li><a href="#section1" class="colored_text">Assignment 1</a></li>
                  <!-- <li><a href="#section2" class="colored_text">Section 2</a></li> -->
              </ul>
          </div><!-- /.navbar-collapse -->
      </div>
  </nav>
  <nav class="breadcrumb-pos" aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="../../index.html">Home</a></li>
      <li class="breadcrumb-item"><a href="../comparison.html">Assignment 1</a></li>
      <li class="breadcrumb-item active" aria-current="page">Stackedchart</li>
    </ol>
  </nav>

<div class="container center">
    <section class="margin-title-section">
      <h1 class="title"> Stacked Bar Chart</h1>
      <hr>
      <!-- Create a div where the graph will take place -->
      <div id="my_dataviz" class="center"></div>
    </section>
    <hr>
</div> <!-- chiude container -->



<footer class="text-center text-lg-start">
    <div class="footer-top-space text-center p-3 background-color colored_text">
        Â© 2022 Copyright:
      <a class="text-dark colored_text" href="https://github.com/IncapacheSpark/IncapacheSpark.github.io">IncapacheSpark Github</a>
    </div>
  </footer>

    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.5/dist/js/bootstrap.min.js"></script>
    <script src="../../js/main.js"></script>
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script>

// set the dimensions and margins of the graph
var margin = {top: 10, right: 10, bottom: 20, left: 180},
    width = 760 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

// Parse the Data
d3.csv("../../python/data/circos_per_trees.csv", function(data) {
  console.log(data);

  var Circos = d3.map(data, function(d){return(d.circoscrizione)}).keys()
  console.log(Circos);
  var TreeNames = d3.map(data, function(d){return(d.Name)}).keys()
  console.log(TreeNames);
  var TreeCount = d3.map(data, function(d){return(d.count)}).keys()
  console.log(TreeCount);

   //Get counts for each circoscrizione
          var dict = {};
          let i = 0
          Circos.forEach(function(data, c){
            //console.log(c)
            while(data[i].circoscrizione == c){
              dict[c] = data[i].count;
              //console.log(data[i].count)
              i++;
            }
          })

  // Add X axis
  var x = d3.scaleLinear()
      .domain([0,100])
      .range([0, width]);
  svg.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x).tickSizeOuter(0));

  // Add Y axis
  var y = d3.scaleBand()
    .domain(Circos)
    .range([ height, 0 ])
    .padding([0.2]);
  svg.append("g")
    .call(d3.axisLeft(y));

  // color palette = one color per subgroup
  var color = d3.scaleOrdinal()
    .domain(TreeNames)
    .range(['#FD0100','#F76915','#EEDE04', '#A0D636', '#2FA236', '#333ED4'])

  //stack the data? --> stack per subgroup
  console.log(dict);
  var stackedData = d3.stack()
    .keys(dict)
    (data)

  // Show the bars
  svg.append("g")
    .selectAll("g")
    // Enter in the stack data = loop key per key = group per group
    .data(stackedData)
    .enter().append("g")
      .attr("fill", function(d) { return color(d.key); })
      .selectAll("rect")
      // enter a second time = loop subgroup per subgroup to add all rectangles
      .data(function(d) { return d; })
      .enter().append("rect")
        .attr("x", function(d) {         console.log(d); return x(d[0]); })
        .attr("y", function(d) { return y(d.data.Circos); })
        .attr("height",y.bandwidth())
        .attr("width", function(d) { return x(d[1]) - x(d[0]); })

})

</script>
  </body>
</html>
