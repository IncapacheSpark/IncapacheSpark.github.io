<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans&family=Roboto+Slab:wght@400;700&display=swap"
          rel="stylesheet"> <!-- Fira Sans & Roboto Slab fonts -->
    <link rel="stylesheet" href="../../css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet"
          type='text/css'>

    <title>IncapacheSpark</title>
</head>

<body>

<!-- ################################# NAVBAR #################################### -->
<nav class="navbar navbar-default background-color navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed colored_text" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../../index.html">
                <img alt="Logo" src="../../img/logo.svg" class="img-logo">
            </a>
        </div>
    </div>
</nav>
<nav class="breadcrumb-pos" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="../../index.html">Home</a></li>
        <li class="breadcrumb-item"><a href="../comparison.html">Assignment 1</a></li>
        <li class="breadcrumb-item active" aria-current="page">Multiple Stackedchart</li>
    </ol>
</nav>

<div class="container center">
    <h1 class="title margin-title-section"> Multiple Stacked Chart </h1>
    <hr>
    <!-- Create a div where the graph will take place -->
    <div id="multipleStackedChart" class="center"></div>
</div>

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.5/dist/js/bootstrap.min.js"></script>
<script src="../../js/main.js"></script>
<script src="https://d3js.org/d3.v4.js"></script>  <!-- Load d3.js -->

<script>
    // set the dimensions and margins of the graph
    var margin = {top: 20, right: 10, bottom: 20, left: 200},
        width = 1100 - margin.left - margin.right,
        height = 600 - margin.top - margin.bottom;

    //Tree types colors
    var tree_type_colors = ['#FD0100', '#F76915', '#EEDE04', '#A0D636', '#2FA236', '#333ED4'];

    var space_between_lines = 150;
    var data_scale = 8;


    // append the svg object to the body of the page
    var svg = d3.select("#multipleStackedChart")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

    // Parse the Data
    d3.csv("../../python/data/circoscrizioni_top_trees.csv", function (data) {

        // List of subgroups = header of the csv files = soil condition here
        var tree_types = data.columns.slice(1);

        // List of groups = species here = value of the first column called group -> I show them on the X axis
        var circoscriozioni = d3.map(data, function (d) {
            return (d.Neighbourhood)
        }).keys();


        // Add Y axis
        var y = d3.scaleBand()
            .domain(circoscriozioni)
            .range([height, 0]);

        svg.append("g")
            .call(d3.axisLeft(y));

        //TODO: for each tree type add line
        var space_between = space_between_lines;
        tree_types.forEach((tree_type, t_index) => {
            if (t_index < tree_types.length - 1) {
                svg.append("line")
                    .attr("y1", 0)
                    .attr("y2", height)
                    .style("stroke-width", 1)
                    .style("stroke", "black")
                    .style("fill", "none")
                    .attr("transform", "translate(" + space_between + ")");
            }

            //Adding Tree type text
            tree_type_splited = tree_type.split(" ");
            var text_space = -5;
            tree_type_splited.forEach(t => {
                svg.append("text")
                    .attr("transform", "translate(" + (space_between - 120) + "," + text_space + ")")
                    .attr("y", 0)
                    .attr("dy", ".35em")
                    .text(t);

                text_space += 10;
            });
            space_between += space_between_lines;
        });

        var rect_x = 0;
        var rect_y = height - 35;

        data.forEach((data_row, d_index) => {
            tree_types.forEach((tree_type, t_index) => {

                var rect_width = data_row[tree_type] / data_scale;
                var rect_color = tree_type_colors[t_index];

                // console.log("y val of y axis", y(circoscriozioni[d_index]));
                // console.log("positioning the bar in ", rect_x, rect_y, "data =", rect_width, "tree_type =", tree_type)

                svg.selectAll("myRect")
                    .data(data)
                    .enter()
                    .append("rect")
                    .attr("x", rect_x)
                    .attr("y", y(circoscriozioni[d_index]) + 15)
                    .attr("width", rect_width)
                    .attr("height", 20)
                    .attr("fill", rect_color);

                if (t_index < 5) {
                    rect_x += space_between_lines;
                }

                if (t_index === 5) {
                    rect_x = 0;
                    rect_y -= width / 12;
                }
            });
        });
    })

</script>

</body>
<footer class="text-center text-lg-start">
    <div class="footer-top-space text-center p-3 background-color colored_text">
        Â© 2022 Copyright:
        <a class="text-dark colored_text" href="https://github.com/IncapacheSpark/IncapacheSpark.github.io">IncapacheSpark
            Github</a>
    </div>
</footer>
</html>
