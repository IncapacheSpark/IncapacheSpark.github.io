<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans&family=Roboto+Slab:wght@400;700&display=swap"
          rel="stylesheet"> <!-- Fira Sans & Roboto Slab fonts -->
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet"
          type='text/css'>

    <title>IncapacheSpark</title>
</head>

<body>

<!-- ################################# NAVBAR #################################### -->
<nav class="navbar navbar-default background-color navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed colored_text" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/index.html">
                <img alt="Logo" src="/img/logo.svg" class="img-logo">
            </a>
        </div>
    </div>
</nav>
<nav class="breadcrumb-pos" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/index.html">Home</a></li>
        <li class="breadcrumb-item"><a href="../comparison.html">Assignment 1</a></li>
        <li class="breadcrumb-item active" aria-current="page">Waffle Chart</li>
    </ol>
</nav>

<div class="container center">
    <h1 class="title margin-title-section"> Waffle Chart</h1>
    <hr>
    <div id="waffle0"></div>
    <div id="waffle1"></div>
    <div id="waffle2"></div>
    <div id="waffle3"></div>
    <div id="waffle4"></div>
    <div id="waffle5"></div>
    <div id="waffle6"></div>
    <div id="waffle7"></div>
    <div id="waffle8"></div>
    <div id="waffle9"></div>
    <div id="waffle10"></div>
    <div id="waffle11"></div>
    <div id="waffle12"></div>
    <div id="legend"></div>
</div> <!-- chiude container -->

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.5/dist/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>

<!-- Load d3.js -->
<script src="http://d3js.org/d3.v6.min.js"></script>

<script>

    var total = 0;

    const color = ['#FD0100', '#F76915', '#EEDE04', '#A0D636', '#2FA236', '#929191']

    d3.csv("https://raw.githubusercontent.com/IncapacheSpark/IncapacheSpark.github.io/main/python/data/circoscrizioni_top_trees.csv").then(function (data) {

        // List of subgroups = header of the csv files = plants
        const TreeNames = Object.keys(data[0]).filter(d => d !== "Neighbourhood");

        //total = d3.sum(data, function(d) { return d.count; });
        k = 0;
        data.forEach((f, i) => {

            var width,
                height,
                widthSquares = 20,
                heightSquares = 5,
                squareSize = 25,
                squareValue = 0,
                gap = 1,
                theData = [];

            //total
            total = 0;
            for (i in TreeNames) {
                name = TreeNames[i];
                total += +f[name];
            }
            //value of a square
            squareValue = total / (widthSquares * heightSquares);

            Object.keys(f).forEach(function (d, i)  //remap data
            {
                if (d === "Neighbourhood") {
                    return;
                }
                //console.log(d);   //accedi nome albero
                //console.log(f[d]);  //accedi count albero
                f[d] = +f[d];
                f.units = Math.floor(f[d] / squareValue);
                theData = theData.concat(
                    Array(f.units + 1).join(1).split('').map(function () {
                        return {
                            squareValue: squareValue,
                            units: f.units,
                            count: f[d],
                            groupIndex: i,
                            nameTree: d
                        };
                    })
                );
            });

            width = (squareSize * widthSquares) + widthSquares * gap + 25;
            height = (squareSize * heightSquares) + heightSquares * gap + 25;

            // create a tooltip
            var tooltip = d3.select("#waffle" + k)
                .append("div")
                .attr("class", "tooltip")
                .style("background-color", "white")
                .style("border", "solid")
                .style("border-width", "1px")
                .style("border-radius", "5px")
                .style("padding", "10px")

            d3.select("#waffle" + k)
                .append("p")
                .text(f.Neighbourhood)
                .style("margin-top", "20px")
                .style("margin-bottom", "-10px")
                .style("font-family", "Roboto slab")
                .style("font-family", "Roboto slab")

            d3.select("#waffle" + k)
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .selectAll("div")
                .data(theData)
                .join("rect")
                .attr("width", squareSize)
                .attr("height", squareSize)
                .attr("fill", function (f) {
                    return color[f.groupIndex - 1];
                })
                .attr("x", function (f, i) {
                    //group n squares for column
                    col = Math.floor(i / heightSquares);
                    return (col * squareSize) + (col * gap);
                })
                .attr("y", function (f, i) {
                    row = i % heightSquares;
                    return (heightSquares * squareSize) - ((row * squareSize) + (row * gap))
                })
                .on("mouseover", function (event, d) { // What happens when user hover a bar

                    tooltip.transition()
                        .duration(200)
                        .style("opacity", 1);

                    tooltip.html("<span class='tooltiptext'>" + "Tree type: " + d.nameTree + "<br>" + "Aboundance: " + d.count + " (" + d.units + "%)" + "</span>")
                        .style("left", (event.pageX) + "px")
                        .style("top", (event.pageY - 28) + "px");

                })
                .on("mouseleave", function (event, d) { // When user do not hover anymore

                    tooltip.transition()
                        .duration(200)
                        .style("opacity", 0);
                });
            k += 1;
        });

        /*

               //add legend with categorical data
               var legend = d3.select("#legend")
                .append("svg")
                .attr('width', 300)
                .attr('height', 200)
                .append('g')
                .selectAll("div")
                .data(data)
                .enter()
                  .append("g")
                  .attr('transform', function(d,i){ return "translate(0," + i*20 + ")";});
              legend.append("rect")
                .attr("width", 18)
                .attr("height", 18)
                .style("fill", function(d, i) { return color(i)});
              legend.append("text")
                .attr("x", 25)
                .attr("y", 13)
                .text( function(d) { return d.tree_species});

                //add value of a unit square
                var legend2 = d3.select("#legend")
                  .select('svg')
                  .append('g')
                  .attr('transform', "translate(100,0)");

            legend2.append("text")
                    .attr('y', '14')
                    .attr('font-size', '18px')
                    .text("Total: " + total)
                    .attr("fill", "#444444"); */
    });

</script>

<footer class="text-center text-lg-start">
    <div class="footer-top-space text-center p-3 background-color colored_text">
        Â© 2022 Copyright:
        <a class="text-dark colored_text" href="https://github.com/IncapacheSpark/IncapacheSpark.github.io">IncapacheSpark
            Github</a>
    </div>
</footer>

</body>
</html>
